<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest Quest - Gamified Productivity</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2E7D32;
            --accent-color: #FFD700;
            --light-text: #E0E0E0;
            --delete-color: #D32F2F;
            --task-bg: rgba(50, 60, 50, 0.9);
            --transition-time: 0.4s;
            --dark-bg: #1C2526;
            --dark-container: rgba(40, 50, 40, 0.95);
            --dark-input-bg: #2A3439;
            --overlay: rgba(0, 0, 0, 0.5);
            --graph-bg: #263238;
            --glow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, sans-serif;
        }

        body {
            background: url('https://assets.grok.com/users/61aa03d5-34a6-451f-a29b-c678af050623/7qqe1265AFQU0oyA-generated_image.jpg') no-repeat center/cover fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--dark-bg);
            color: var(--light-text);
            position: relative;
            overflow-x: hidden;
            transition: background-image 1s ease-in-out;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            z-index: -1;
        }

        /* Forest Particle Effect */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(76, 175, 80, 0.7);
            border-radius: 50%;
            animation: float 8s infinite ease-in-out;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); opacity: 0.3; }
            50% { transform: translateY(-20vh); opacity: 0.8; }
        }

        .container {
            width: 90%;
            max-width: 850px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--dark-container);
            border-radius: 20px;
            box-shadow: var(--glow), 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            position: relative;
            z-index: 1;
            animation: fadeIn 0.8s ease-out;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.8rem;
            color: var(--primary-color);
            text-shadow: var(--glow);
            display: inline-flex;
            align-items: center;
        }

        .coin-icon, .leaf-icon {
            width: 28px;
            height: 28px;
            margin: 0 8px;
            transition: transform 0.3s ease;
        }
        .coin-icon:hover, .leaf-icon:hover {
            transform: rotate(15deg) scale(1.1);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            border-radius: 12px;
            box-shadow: var(--glow);
            margin-bottom: 2rem;
            animation: slideIn 0.6s ease-out;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--accent-color);
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .level-progress, .task-progress, .subject-progress {
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .progress-bar, .task-progress-bar, .subject-progress-bar {
            height: 100%;
            background: var(--accent-color);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
            box-shadow: 0 0 8px var(--accent-color);
        }

        .task-progress-bar {
            background: var(--primary-color);
        }

        .task-item.overdue .task-progress-bar {
            background: var(--delete-color);
            box-shadow: 0 0 8px var(--delete-color);
        }

        button {
            padding: 0.8rem 1.6rem;
            background: var(--primary-color);
            color: var(--light-text);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all var(--transition-time) ease;
            box-shadow: var(--glow);
        }

        button:hover {
            background: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.6);
        }

        .targets-btn {
            background: var(--accent-color);
            color: #1A1A1A;
        }

        .targets-btn:hover {
            background: #FFC107;
        }

        .targets-popup, .marks-input-popup, .level-up {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark-container);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: var(--glow), 0 10px 40px rgba(0, 0, 0, 0.4);
            max-height: 85vh;
            overflow-y: auto;
            z-index: 101;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .targets-popup.show, .marks-input-popup.show, .level-up.show {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .targets-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .targets-close:hover {
            color: var(--delete-color);
        }

        .targets-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .targets-table tr.class-row {
            background: var(--secondary-color);
            color: var(--light-text);
            font-weight: 600;
        }

        .targets-table tr.subject-row {
            background: #FFF;
            color: #000;
            font-weight: 600;
        }

        .targets-table td {
            padding: 0.6rem;
            border-bottom: 1px solid #444;
        }

        .progress-input {
            width: 50px;
            padding: 0.3rem;
            background: var(--dark-input-bg);
            color: var(--light-text);
            border: 1px solid #555;
            border-radius: 5px;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .progress-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .add-task-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1.2rem;
            margin-bottom: 2rem;
        }

        input, select {
            padding: 0.8rem;
            border: 1px solid #555;
            border-radius: 6px;
            background: var(--dark-input-bg);
            color: var(--light-text);
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .deadline-inputs {
            display: flex;
            gap: 1rem;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            background: var(--task-bg);
            border-radius: 10px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.5s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .task-name {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .task-deadline {
            font-size: 0.95rem;
            color: #B0BEC5;
        }

        .urgent {
            color: var(--delete-color);
            font-weight: bold;
        }

        .task-actions {
            display: flex;
            gap: 0.8rem;
        }

        .complete-btn {
            background: var(--primary-color);
        }

        .delete-btn {
            background: var(--delete-color);
        }

        .level-up h2 {
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--accent-color);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #90A4AE;
            animation: fadeIn 0.8s ease;
        }

        .blur {
            filter: blur(6px);
            transition: filter 0.5s ease;
        }

        .signin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .signin-overlay.show {
            opacity: 1;
        }

        .signin-box {
            background: var(--dark-container);
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: var(--glow);
            animation: popIn 0.5s ease-out;
        }

        .signin-box h2 {
            color: var(--primary-color);
            text-shadow: var(--glow);
        }

        .signin-error {
            color: var(--delete-color);
            font-size: 0.9rem;
        }

        .signout-btn {
            background: var(--delete-color);
        }

        .graph-sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--graph-bg);
            z-index: 102;
            transition: left var(--transition-time) ease;
            padding: 2rem;
        }

        .graph-sidebar.open {
            left: 0;
        }

        .graph-container {
            background: #37474F;
            border-radius: 10px;
            padding: 1rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes coinPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .coin-animation {
            animation: coinPulse 0.5s ease-out;
        }

        @media (max-width: 600px) {
            .add-task-form { grid-template-columns: 1fr; }
            .deadline-inputs { flex-direction: column; }
            .task-item { flex-direction: column; align-items: flex-start; }
            .task-actions { margin-top: 1rem; }
        }
    </style>
</head>
<body>
    <div id="particles"></div>
    <div class="container main-content">
        <header>
            <h1>Forest Quest<img src="https://pngimg.com/d/coin_PNG36871.png" alt="Coin" class="coin-icon"><img src="https://i.ytimg.com/vi/eTeBsgG3lkw/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLBsbiZakg7W-jPkhJtBh3mS2zeNrQ" alt="Leaf" class="leaf-icon"></h1>
            <p>Grow your forest by completing tasks and earning rewards!</p>
        </header>

        <button class="signout-btn" id="signout-btn" style="display: none;">Sign Out</button>

        <div class="stats">
            <div class="stat"><div>LEVEL</div><div class="stat-value" id="level">1</div></div>
            <div class="stat"><div>COINS</div><div class="stat-value" id="coins">0</div></div>
            <div class="stat"><div>TASKS DONE</div><div class="stat-value" id="tasks-completed">0</div></div>
        </div>

        <div>
            <div>Level Progress</div>
            <div class="level-progress"><div class="progress-bar" id="level-progress-bar" style="width: 0%"></div></div>
        </div>

        <form id="add-task-form" class="add-task-form">
            <div class="form-group">
                <label for="task-name">Task Name:</label>
                <input type="text" id="task-name" required placeholder="Enter task...">
            </div>
            <div class="form-group">
                <label for="deadline-date">Deadline:</label>
                <div class="deadline-inputs">
                    <input type="date" id="deadline-date" required>
                    <input type="time" id="deadline-time" required>
                </div>
            </div>
            <button type="submit">Add Task</button>
        </form>

        <button class="targets-btn" id="targets-btn">Targets</button>

        <div>
            <h2>Tasks</h2>
            <ul id="task-list" class="task-list">
                <div class="empty-state" id="empty-tasks">No tasks yet—add one to begin!</div>
            </ul>
        </div>
    </div>

    <div class="level-up" id="level-up-popup">
        <h2>Level Up!</h2>
        <p>You’ve reached Level <span id="new-level">2</span>!</p>
        <p>Your forest flourishes...</p>
        <button id="level-up-ok">Continue</button>
    </div>

    <div class="targets-popup" id="targets-popup">
        <button class="targets-close" id="targets-close">×</button>
        <table class="targets-table">
            <tbody>
                <tr class="class-row"><td colspan="3">Class 11</td></tr>
                <tr class="subject-row"><td colspan="3">Physics</td></tr>
                <tr class="topic-row"><td>Physical World</td><td><div class="subject-progress" data-subject="Physical World"><div class="subject-progress-bar"></div></div></td><td><input type="text" class="progress-input" placeholder="0Q"></td></tr>
                <!-- Add more topics as needed -->
            </tbody>
        </table>
    </div>

    <div class="signin-overlay" id="signin-overlay">
        <div class="signin-box">
            <h2>Sign In</h2>
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <label><input type="checkbox" id="stay-signed-in"> Stay Signed In</label>
            <button id="signin-btn">Sign In</button>
            <p class="signin-error" id="signin-error" style="display: none;">Invalid credentials</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game State
            let gameState = { coins: 0, level: 1, tasksCompleted: 0, tasks: new Map() };
            let subjectProgress = new Map();
            let currentUser = null;

            // DOM Elements
            const elements = {
                coins: document.getElementById('coins'),
                level: document.getElementById('level'),
                tasksCompleted: document.getElementById('tasks-completed'),
                progressBar: document.getElementById('level-progress-bar'),
                taskList: document.getElementById('task-list'),
                emptyTasks: document.getElementById('empty-tasks'),
                addTaskForm: document.getElementById('add-task-form'),
                taskName: document.getElementById('task-name'),
                deadlineDate: document.getElementById('deadline-date'),
                deadlineTime: document.getElementById('deadline-time'),
                levelUpPopup: document.getElementById('level-up-popup'),
                newLevel: document.getElementById('new-level'),
                levelUpOk: document.getElementById('level-up-ok'),
                targetsBtn: document.getElementById('targets-btn'),
                targetsPopup: document.getElementById('targets-popup'),
                targetsClose: document.getElementById('targets-close'),
                signinOverlay: document.getElementById('signin-overlay'),
                signinBtn: document.getElementById('signin-btn'),
                username: document.getElementById('username'),
                password: document.getElementById('password'),
                staySignedIn: document.getElementById('stay-signed-in'),
                signinError: document.getElementById('signin-error'),
                mainContent: document.querySelector('.main-content'),
                signoutBtn: document.getElementById('signout-btn')
            };

            const backgroundImages = {
                0: 'https://assets.grok.com/users/61aa03d5-34a6-451f-a29b-c678af050623/7qqe1265AFQU0oyA-generated_image.jpg',
                1: 'https://ih1.redbubble.net/image.4971990187.8956/raf,360x360,075,t,fafafa:ca443f4786.jpg',
                2: 'https://wallpapers.com/images/hd/lo-fi-anime-chill-zpbeiv7k1y45zwat.jpg',
                3: 'https://i.ytimg.com/vi/KAqUpjcs_xc/hq720.jpg',
                4: 'https://i1.sndcdn.com/artworks-G9UzrSoAlsn4Ed7i-AAjR3Q-t500x500.jpg',
                5: 'https://i1.sndcdn.com/artworks-RqAOy7Z3ktf3xBLd-5KXuqA-t500x500.jpg'
            };

            let intervalId = null;

            // Particle Effect
            const particlesDiv = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 8}s`;
                particlesDiv.appendChild(particle);
            }

            // User Management
            const loadUsers = () => JSON.parse(localStorage.getItem('forestQuestUsers')) || {};
            const saveUsers = users => localStorage.setItem('forestQuestUsers', JSON.stringify(users));
            const loadSignedInUser = () => localStorage.getItem('signedInUser');
            const saveSignedInUser = username => localStorage.setItem('signedInUser', username);
            const clearSignedInUser = () => localStorage.removeItem('signedInUser');

            function signIn(username, password, staySignedIn) {
                const users = loadUsers();
                if (users[username]?.password === password || !users[username]) {
                    if (!users[username]) {
                        users[username] = { password };
                        saveUsers(users);
                    }
                    currentUser = username;
                    if (staySignedIn) saveSignedInUser(username);
                    elements.signinOverlay.classList.remove('show');
                    elements.mainContent.classList.remove('blur');
                    elements.signoutBtn.style.display = 'block';
                    loadGameState();
                    loadSubjectProgress();
                } else {
                    elements.signinError.style.display = 'block';
                }
            }

            function signOut() {
                currentUser = null;
                clearSignedInUser();
                elements.signoutBtn.style.display = 'none';
                elements.mainContent.classList.add('blur');
                elements.signinOverlay.classList.add('show');
                elements.username.value = '';
                elements.password.value = '';
                elements.staySignedIn.checked = false;
                elements.signinError.style.display = 'none';
                if (intervalId) clearInterval(intervalId);
            }

            elements.signinBtn.addEventListener('click', () => {
                const username = elements.username.value.trim();
                const password = elements.password.value.trim();
                if (username && password) signIn(username, password, elements.staySignedIn.checked);
            });

            elements.signoutBtn.addEventListener('click', signOut);

            // Game Logic
            function loadGameState() {
                if (!currentUser) return;
                const savedState = JSON.parse(localStorage.getItem(`forestQuestState_${currentUser}`));
                if (savedState) {
                    gameState = {
                        coins: savedState.coins || 0,
                        level: savedState.level || 1,
                        tasksCompleted: savedState.tasksCompleted || 0,
                        tasks: new Map(savedState.tasks?.map(t => [t.id, t]) || [])
                    };
                }
                updateUI();
                updateBackground();
                renderTasks();
                if (intervalId) clearInterval(intervalId);
                intervalId = setInterval(checkDeadlines, 30000); // Reduced interval for better responsiveness
            }

            function saveGameState() {
                if (!currentUser) return;
                localStorage.setItem(`forestQuestState_${currentUser}`, JSON.stringify({
                    coins: gameState.coins,
                    level: gameState.level,
                    tasksCompleted: gameState.tasksCompleted,
                    tasks: Array.from(gameState.tasks.values())
                }));
            }

            function updateUI() {
                elements.coins.textContent = gameState.coins;
                elements.level.textContent = gameState.level;
                elements.tasksCompleted.textContent = gameState.tasksCompleted;
                const progress = (gameState.coins % 1000) / 10;
                elements.progressBar.style.width = `${Math.min(progress, 100)}%`;
            }

            function updateBackground() {
                document.body.style.backgroundImage = `url('${backgroundImages[Math.min(gameState.level, 5)]}')`;
            }

            function generateTaskId() {
                return `${Date.now().toString(36)}${Math.random().toString(36).substr(2, 5)}`;
            }

            function formatDateTime(date) {
                return new Date(date).toLocaleString('en-US', {
                    month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });
            }

            function calculateTaskProgress(deadline, created) {
                const now = Date.now();
                const deadlineDate = new Date(deadline).getTime();
                const createdDate = new Date(created).getTime();
                const progress = ((now - createdDate) / (deadlineDate - createdDate)) * 100;
                return Math.min(Math.max(progress, 0), 100);
            }

            function renderTasks() {
                elements.taskList.innerHTML = gameState.tasks.size === 0 ? '' : '';
                elements.emptyTasks.style.display = gameState.tasks.size === 0 ? 'block' : 'none';

                const fragment = document.createDocumentFragment();
                Array.from(gameState.tasks.values())
                    .sort((a, b) => new Date(a.deadline) - new Date(b.deadline))
                    .forEach(task => {
                        const isOverdue = new Date(task.deadline) < new Date();
                        const progress = calculateTaskProgress(task.deadline, task.created);
                        const taskItem = document.createElement('li');
                        taskItem.className = `task-item ${isOverdue ? 'overdue' : ''}`;
                        taskItem.dataset.id = task.id;
                        taskItem.innerHTML = `
                            <div class="task-details">
                                <div class="task-name">${task.name}</div>
                                <div class="task-deadline ${isOverdue ? 'urgent' : ''}">
                                    ${isOverdue ? '⚠️ Overdue: ' : 'Due: '}${formatDateTime(task.deadline)}
                                </div>
                                <div class="task-progress">
                                    <div class="task-progress-bar" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            <div class="task-actions">
                                <button class="complete-btn">✓</button>
                                <button class="delete-btn">✗</button>
                            </div>
                        `;
                        taskItem.querySelector('.complete-btn').addEventListener('click', () => completeTask(task.id));
                        taskItem.querySelector('.delete-btn').addEventListener('click', () => deleteTask(task.id));
                        fragment.appendChild(taskItem);
                    });
                elements.taskList.appendChild(fragment);
            }

            function addTask(name, deadline) {
                const id = generateTaskId();
                if (gameState.tasks.has(id) || Array.from(gameState.tasks.values()).some(t => t.name === name && t.deadline === deadline)) return;
                gameState.tasks.set(id, { id, name, deadline, created: new Date().toISOString() });
                saveGameState();
                renderTasks();
            }

            function completeTask(taskId) {
                if (!gameState.tasks.has(taskId)) return;
                gameState.tasks.delete(taskId);
                gameState.coins += 100;
                gameState.tasksCompleted++;
                checkLevelUp();
                saveGameState();
                renderTasks();
                updateUI();
            }

            function deleteTask(taskId) {
                gameState.tasks.delete(taskId);
                saveGameState();
                renderTasks();
            }

            function checkLevelUp() {
                const newLevel = Math.floor(gameState.coins / 1000) + 1;
                if (newLevel > gameState.level) {
                    gameState.level = newLevel;
                    elements.newLevel.textContent = newLevel;
                    elements.levelUpPopup.classList.add('show');
                    updateBackground();
                }
            }

            function checkDeadlines() {
                let penalty = false;
                for (const task of gameState.tasks.values()) {
                    if (new Date(task.deadline) < new Date()) penalty = true;
                }
                if (penalty) gameState.coins = Math.max(0, gameState.coins - 50);
                saveGameState();
                updateUI();
                renderTasks();
            }

            // Subject Progress
            function loadSubjectProgress() {
                if (!currentUser) return;
                const saved = JSON.parse(localStorage.getItem(`subjectProgress_${currentUser}`));
                if (saved) subjectProgress = new Map(saved);
                updateSubjectProgressBars();
            }

            function saveSubjectProgress() {
                if (!currentUser) localStorage.setItem(`subjectProgress_${currentUser}`, JSON.stringify([...subjectProgress]));
            }

            function updateSubjectProgressBars() {
                document.querySelectorAll('.subject-progress').forEach(bar => {
                    const subject = bar.dataset.subject;
                    const progress = (subjectProgress.get(subject) || 0) / 112 * 100; // Assuming 112 questions per topic
                    bar.querySelector('.subject-progress-bar').style.width = `${Math.min(progress, 100)}%`;
                    const input = bar.parentElement.nextElementSibling.querySelector('.progress-input');
                    input.value = subjectProgress.get(subject) || '';
                });
            }

            document.querySelectorAll('.progress-input').forEach(input => {
                input.addEventListener('input', e => {
                    const subject = e.target.closest('tr').querySelector('.subject-progress').dataset.subject;
                    const value = parseInt(e.target.value.replace(/\D/g, '')) || 0;
                    subjectProgress.set(subject, value);
                    saveSubjectProgress();
                    updateSubjectProgressBars();
                });
            });

            // Event Listeners
            elements.addTaskForm.addEventListener('submit', e => {
                e.preventDefault();
                const name = elements.taskName.value.trim();
                const deadline = new Date(`${elements.deadlineDate.value}T${elements.deadlineTime.value}`).toISOString();
                if (name && deadline) {
                    addTask(name, deadline);
                    elements.taskName.value = '';
                }
            });

            elements.levelUpOk.addEventListener('click', () => elements.levelUpPopup.classList.remove('show'));
            elements.targetsBtn.addEventListener('click', () => elements.targetsPopup.classList.add('show'));
            elements.targetsClose.addEventListener('click', () => elements.targetsPopup.classList.remove('show'));

            // Initialization
            const today = new Date();
            elements.deadlineDate.value = today.toISOString().split('T')[0];
            elements.deadlineTime.value = '23:59';

            const signedInUser = loadSignedInUser();
            if (signedInUser) {
                currentUser = signedInUser;
                elements.signinOverlay.classList.remove('show');
                elements.mainContent.classList.remove('blur');
                elements.signoutBtn.style.display = 'block';
                loadGameState();
                loadSubjectProgress();
            } else {
                elements.mainContent.classList.add('blur');
                elements.signinOverlay.classList.add('show');
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Focus Mode</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #111;
            color: white;
            overflow: hidden;
        }
        
        .home-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            padding: 20px;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 2rem;
            text-align: center;
            background: linear-gradient(45deg, #4cc9f0, #4361ee, #7209b7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .input-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 1rem;
        }
        
        .url-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 1rem;
            width: 100%;
        }
        
        .url-input-group {
            display: flex;
            width: 100%;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px 15px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px 0 0 5px;
            color: white;
            font-size: 1rem;
        }
        
        .remove-url-btn {
            background: #e63946;
            color: white;
            border: none;
            padding: 0 15px;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
        }
        
        .add-url-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .add-url-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .timer-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .timer-input label {
            font-size: 1rem;
        }
        
        .timer-input input {
            padding: 10px;
            width: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
            text-align: center;
        }
        
        .start-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.4);
        }
        
        .focus-screen {
            display: none;
            position: relative;
            height: 100vh;
            width: 100vw;
            background: #000;
        }
        
        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 2;
        }
        
        .restart-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .clock {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 2;
            font-size: 1.5rem;
        }
        
        .time {
            color: #4cc9f0;
        }
        
        .ampm {
            color: #7209b7;
        }
        
        .timer {
            position: absolute;
            top: 45px;
            left: 10px;
            z-index: 2;
            font-size: 1.2rem;
            color: white;
        }
        
        .pomodoro {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            width: 300px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .pomodoro-progress {
            height: 100%;
            width: 0;
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
            border-radius: 5px;
            transition: width 1s linear;
        }
        
        .score {
            position: absolute;
            top: 10px;
            right: 100px;
            z-index: 2;
            font-size: 1.2rem;
        }
        
        .audio-player {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .play-pause-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
        }
        
        .visualizer {
            width: 150px;
            height: 50px;
            background: #1a1a2e;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .visualizer-bars {
            display: flex;
            height: 100%;
            align-items: flex-end;
            gap: 2px;
            padding: 0 5px;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(to top, #4cc9f0, #7209b7);
            margin: 0 1px;
            border-radius: 2px 2px 0 0;
            height: 5px;
        }
    </style>
</head>
<body>
    <div class="home-screen" id="homeScreen">
        <h1>Ultra Focus Mode</h1>
        <div class="input-container">
            <div class="url-inputs" id="urlInputs">
                <div class="url-input-group">
                    <input type="text" placeholder="Enter YouTube URL..." class="youtube-url">
                    <button class="remove-url-btn">×</button>
                </div>
            </div>
            <button class="add-url-btn" id="addUrlBtn">+ Add another YouTube URL</button>
        </div>
        <div class="timer-input">
            <label for="timerInput">Timer (minutes):</label>
            <input type="number" id="timerInput" min="1" max="180" value="50">
        </div>
        <button class="start-btn" id="startBtn">Start Focus Mode</button>
    </div>

    <div class="focus-screen" id="focusScreen">
        <div class="video-container" id="videoContainer"></div>
        <div class="clock">
            <span class="time" id="clockTime">12:00</span>
            <span class="ampm" id="clockAmPm">AM</span>
        </div>
        <div class="timer" id="countdownTimer">50:00</div>
        <div class="pomodoro">
            <div class="pomodoro-progress" id="pomodoroProgress"></div>
        </div>
        <div class="score" id="scoreDisplay">Score: 0</div>
        <div class="controls">
            <button class="restart-btn" id="restartBtn">Restart</button>
        </div>
    </div>

    <div class="audio-player">
        <button class="play-pause-btn" id="playPauseBtn">▶</button>
        <div class="visualizer">
            <div class="visualizer-bars" id="visualizerBars">
                <!-- Bars will be added dynamically -->
            </div>
        </div>
    </div>

    <audio id="lofiAudio" loop>
        <source src="https://www.dropbox.com/scl/fi/7qrgbk6vpej7x0ih7vev2/1-6_XRwBX7NX-1.mp3?rlkey=m3gntnys7az2hoq0iokkajucj&st=9ox8s9oi&dl=1" type="audio/mp3">
    </audio>
    <audio id="alarmAudio" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869.wav" type="audio/wav">
    </audio>

    <script>
        // DOM Elements
        const homeScreen = document.getElementById('homeScreen');
        const focusScreen = document.getElementById('focusScreen');
        const urlInputs = document.getElementById('urlInputs');
        const addUrlBtn = document.getElementById('addUrlBtn');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const videoContainer = document.getElementById('videoContainer');
        const clockTime = document.getElementById('clockTime');
        const clockAmPm = document.getElementById('clockAmPm');
        const countdownTimer = document.getElementById('countdownTimer');
        const pomodoroProgress = document.getElementById('pomodoroProgress');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const visualizerBars = document.getElementById('visualizerBars');
        const lofiAudio = document.getElementById('lofiAudio');
        const alarmAudio = document.getElementById('alarmAudio');
        const timerInput = document.getElementById('timerInput');

        // State variables
        let score = 0;
        let videoUrls = [];
        let currentVideoIndex = 0;
        let pomodoroDuration = 50 * 60; // default 50 minutes in seconds
        let remainingTime = pomodoroDuration;
        let timerInterval;
        let isPlaying = false;
        let tabWasHidden = false;
        let audioContext;
        let analyser;
        let dataArray;
        let barCount = 20;

        // Initialize visualizer
        for (let i = 0; i < barCount; i++) {
            const bar = document.createElement('div');
            bar.className = 'bar';
            visualizerBars.appendChild(bar);
        }

        // Add URL input
        addUrlBtn.addEventListener('click', () => {
            const urlGroup = document.createElement('div');
            urlGroup.className = 'url-input-group';
            urlGroup.innerHTML = `
                <input type="text" placeholder="Enter YouTube URL..." class="youtube-url">
                <button class="remove-url-btn">×</button>
            `;
            urlInputs.appendChild(urlGroup);
            
            // Add event listener to new remove button
            const removeBtn = urlGroup.querySelector('.remove-url-btn');
            removeBtn.addEventListener('click', () => {
                if (urlInputs.children.length > 1) {
                    urlGroup.remove();
                }
            });
        });

        // Remove URL input
        urlInputs.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-url-btn')) {
                if (urlInputs.children.length > 1) {
                    e.target.parentElement.remove();
                }
            }
        });

        // Audio Control
        playPauseBtn.addEventListener('click', toggleAudio);

        function toggleAudio() {
            if (isPlaying) {
                lofiAudio.pause();
                playPauseBtn.textContent = '▶';
            } else {
                if (!audioContext) {
                    setupAudioVisualizer();
                }
                lofiAudio.play();
                playPauseBtn.textContent = '⏸';
            }
            isPlaying = !isPlaying;
        }

        function setupAudioVisualizer() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            
            const source = audioContext.createMediaElementSource(lofiAudio);
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            
            analyser.fftSize = 64;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            
            updateVisualizer();
        }

        function updateVisualizer() {
            if (!audioContext) return;
            
            requestAnimationFrame(updateVisualizer);
            analyser.getByteFrequencyData(dataArray);
            
            const bars = visualizerBars.querySelectorAll('.bar');
            const step = Math.floor(dataArray.length / bars.length);
            
            for (let i = 0; i < bars.length; i++) {
                const value = dataArray[i * step] / 255;
                const height = Math.max(5, value * 50); // Min height 5px, max 50px
                bars[i].style.height = `${height}px`;
            }
        }

        // Clock function
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // hour '0' should be '12'
            const minutes = now.getMinutes().toString().padStart(2, '0');
            
            clockTime.textContent = `${hours}:${minutes}`;
            clockAmPm.textContent = ampm;
        }

        // Timer function
        function startTimer(duration) {
            clearInterval(timerInterval);
            remainingTime = duration;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();
                updatePomodoroProgress();
                
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    completePomodoro();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            countdownTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function updatePomodoroProgress() {
            const progressPercentage = ((pomodoroDuration - remainingTime) / pomodoroDuration) * 100;
            pomodoroProgress.style.width = `${progressPercentage}%`;
        }

        function completePomodoro() {
            score += 80;
            updateScore();
            alert('Pomodoro completed! +80 points');
        }

        function updateScore() {
            scoreDisplay.textContent = `Score: ${score}`;
            saveScore();
        }

        // Tab visibility change detection
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden' && focusScreen.style.display === 'block') {
                // User switched tabs during focus mode
                tabWasHidden = true;
                alarmAudio.play();
                score -= 10;
                updateScore();
            } else if (document.visibilityState === 'visible' && tabWasHidden) {
                // User came back to the tab
                tabWasHidden = false;
                alarmAudio.pause();
                alarmAudio.currentTime = 0;
            }
        });

        // Local storage functions
        function saveScore() {
            localStorage.setItem('focusModeScore', score);
        }

        function loadScore() {
            const savedScore = localStorage.getItem('focusModeScore');
            if (savedScore !== null) {
                score = parseInt(savedScore);
                updateScore();
            }
        }

        function saveVideoUrls() {
            localStorage.setItem('focusModeUrls', JSON.stringify(videoUrls));
        }

        function loadVideoUrls() {
            const savedUrls = localStorage.getItem('focusModeUrls');
            if (savedUrls) {
                videoUrls = JSON.parse(savedUrls);
                
                // Clear existing inputs
                while (urlInputs.firstChild) {
                    urlInputs.removeChild(urlInputs.firstChild);
                }
                
                // Create inputs for each saved URL
                videoUrls.forEach(url => {
                    const urlGroup = document.createElement('div');
                    urlGroup.className = 'url-input-group';
                    urlGroup.innerHTML = `
                        <input type="text" placeholder="Enter YouTube URL..." class="youtube-url" value="${url}">
                        <button class="remove-url-btn">×</button>
                    `;
                    urlInputs.appendChild(urlGroup);
                });
                
                // If no URLs were loaded, add one empty input
                if (videoUrls.length === 0) {
                    addUrlBtn.click();
                }
            }
        }

        // YouTube URL to Embed URL conversion
        function getYouTubeEmbedUrl(url) {
            let videoId = '';
            
            // Regular YouTube URL format
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            
            if (match && match[2].length === 11) {
                videoId = match[2];
            } else {
                // Not a valid YouTube URL, return as is (error will be handled elsewhere)
                return url;
            }
            
            return `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1`;
        }

        // Start focus mode
        startBtn.addEventListener('click', () => {
            // Collect all YouTube URLs
            videoUrls = [];
            const urlInputElements = document.querySelectorAll('.youtube-url');
            urlInputElements.forEach(input => {
                if (input.value.trim() !== '') {
                    videoUrls.push(input.value);
                }
            });
            
            if (videoUrls.length === 0) {
                alert('Please enter at least one YouTube URL');
                return;
            }
            
            // Save URLs to local storage
            saveVideoUrls();
            
            // Get timer duration
            pomodoroDuration = parseInt(timerInput.value) * 60;
            
            // Switch to focus mode
            homeScreen.style.display = 'none';
            focusScreen.style.display = 'block';
            
            // Embed the first video
            loadVideo(0);
            
            // Start the timer
            startTimer(pomodoroDuration);
            
            // Start the clock
            updateClock();
            setInterval(updateClock, 60000); // Update every minute
            
            // If audio was playing on home screen, keep it playing
            if (isPlaying) {
                lofiAudio.play();
            }
        });

        // Load a video by index
        function loadVideo(index) {
            if (index >= 0 && index < videoUrls.length) {
                currentVideoIndex = index;
                const embedUrl = getYouTubeEmbedUrl(videoUrls[index]);
                videoContainer.innerHTML = `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
            }
        }

        // Switch videos with 'T' key
        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 't' && focusScreen.style.display === 'block') {
                currentVideoIndex = (currentVideoIndex + 1) % videoUrls.length;
                loadVideo(currentVideoIndex);
            }
        });

        // Restart button
        restartBtn.addEventListener('click', () => {
            // Stop timer
            clearInterval(timerInterval);
            
            // Switch back to home screen
            focusScreen.style.display = 'none';
            homeScreen.style.display = 'flex';
            
            // Stop any videos
            videoContainer.innerHTML = '';
        });

        // Load saved data on page load
        window.addEventListener('load', () => {
            loadScore();
            loadVideoUrls();
        });
    </script>
</body>
</html>

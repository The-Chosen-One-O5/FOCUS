<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Mode YouTube Player</title>
  <style>
    :root {
      --main-bg-color: #121212;
      --text-color: #ffffff;
      --accent-color: #3a86ff;
      --secondary-accent: #8338ec;
      --success-color: #06d6a0;
      --danger-color: #ef476f;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: var(--main-bg-color);
      color: var(--text-color);
      font-family: 'Poppins', sans-serif;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Home Screen */
    #home-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }

    .title {
      font-size: 3rem;
      margin-bottom: 10px;
      color: var(--accent-color);
    }

    .subtitle {
      font-size: 1.2rem;
      margin-bottom: 30px;
      opacity: 0.8;
    }

    .btn {
      background-color: var(--accent-color);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
    }

    .btn:hover {
      background-color: var(--secondary-accent);
      transform: translateY(-2px);
    }

    .btn-success {
      background-color: var(--success-color);
    }

    .clock-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .light-blue-text {
      color: #7fdbff;
      font-size: 2rem;
      font-weight: bold;
    }

    .purple-text {
      color: #8338ec;
    }

    .timer-container {
      margin-top: 10px;
      display: flex;
      align-items: center;
    }

    .timer-input {
      width: 60px;
      padding: 8px;
      margin-right: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      color: white;
    }

    #youtube-url-section {
      margin-top: 30px;
      width: 100%;
      max-width: 600px;
    }

    .url-input {
      width: 100%;
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      color: white;
    }

    #audio-player {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 200px;
    }

    #audio-visualizer {
      width: 200px;
      height: 80px;
      background: linear-gradient(90deg, #3a86ff, #8338ec);
      border-radius: 5px;
      margin-bottom: 10px;
      overflow: hidden;
    }

    .player-controls {
      display: flex;
      justify-content: center;
    }

    /* Focus Mode Screen */
    #focus-mode-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      z-index: 1000;
    }

    #focus-header {
      position: absolute;
      top: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: rgba(0,0,0,0.7);
      z-index: 10;
    }

    #pomodoro-timer {
      font-size: 1.5rem;
      color: var(--success-color);
    }

    #points-display {
      font-size: 1.2rem;
      color: var(--accent-color);
    }

    #restart-button {
      background-color: var(--danger-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }

    #youtube-player {
      width: 100%;
      height: 100%;
    }

    .hidden {
      display: none !important;
    }

    /* Stats Section */
    .stats-container {
      background: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: left;
    }

    .stats-title {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: var(--accent-color);
    }

    .stat-item {
      margin: 8px 0;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <!-- Home Screen -->
  <div id="home-screen">
    <h1 class="title">Focus Mode YouTube Player</h1>
    <p class="subtitle">Watch Videos without distraction like a GIGACHAD!</p>
    
    <div class="clock-container">
      <div id="clock" class="light-blue-text">12:00 <span class="purple-text">PM</span></div>
      <div class="timer-container">
        <input type="number" id="timer-minutes" class="timer-input" min="1" max="180" value="50">
        <button id="start-timer" class="btn">Set Timer</button>
      </div>
    </div>
    
    <div id="youtube-url-section">
      <h2>Enter YouTube URLs</h2>
      <div id="url-inputs">
        <input type="text" class="url-input youtube-url" placeholder="Paste YouTube URL here">
      </div>
      <button id="add-more-url" class="btn">Add Another URL</button>
      <button id="start-focus-mode" class="btn btn-success">Start Focus Mode</button>
    </div>
    
    <div class="stats-container">
      <h3 class="stats-title">Your Focus Stats</h3>
      <div class="stat-item">Total Focus Time: <span id="total-focus-time">0</span> min</div>
      <div class="stat-item">Total Distractions: <span id="total-distractions">0</span></div>
      <div class="stat-item">Videos Watched: <span id="videos-watched">0</span></div>
      <div class="stat-item">Total Points: <span id="total-points">0</span></div>
    </div>
    
    <div id="audio-player">
      <canvas id="audio-visualizer"></canvas>
      <div class="player-controls">
        <button id="play-pause" class="btn">▶️</button>
      </div>
      <audio id="background-music" loop>
        <source src="https://www.dropbox.com/scl/fi/7qrgbk6vpej7x0ih7vev2/1-6_XRwBX7NX-1.mp3?rlkey=m3gntnys7az2hoq0iokkajucj&st=9ox8s9oi&dl=1" type="audio/mpeg">
      </audio>
      <audio id="alarm-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>
    </div>
  </div>
  
  <!-- Focus Mode Screen (initially hidden) -->
  <div id="focus-mode-screen" class="hidden">
    <div id="focus-header">
      <div id="focus-clock" class="light-blue-text">12:00 <span class="purple-text">PM</span></div>
      <div id="pomodoro-timer">50:00</div>
      <div id="points-display">Points: 0</div>
      <button id="restart-button">Restart</button>
    </div>
    
    <div id="youtube-player"></div>
  </div>

  <!-- YouTube API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  
  <script>
    // Global variables
    let player;
    let currentVideoIndex = 0;
    let playlist = [];
    let pomodoroInterval;
    let pomodoroTimeLeft = 50 * 60; // 50 minutes in seconds
    let focusModeActive = false;
    let points = 0;
    let userData = {
      points: 0,
      focusTime: 0,
      distractions: 0,
      videosWatched: 0
    };
    let alarmLoopInterval;
    
    // Initialize the application
    function init() {
      updateClock();
      setInterval(updateClock, 1000);
      loadUserData();
      setupEventListeners();
      setupAudioVisualizer();
    }
    
    // Update the clock display
    function updateClock() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      
      hours = hours % 12;
      hours = hours ? hours : 12; // Convert 0 to 12
      
      document.getElementById('clock').innerHTML = 
        `${hours}:${minutes} <span class="purple-text">${ampm}</span>`;
      
      if (document.getElementById('focus-clock')) {
        document.getElementById('focus-clock').innerHTML = 
          `${hours}:${minutes} <span class="purple-text">${ampm}</span>`;
      }
    }
    
    // Load user data from localStorage
    function loadUserData() {
      userData = JSON.parse(localStorage.getItem('focusModeData')) || {
        points: 0,
        focusTime: 0,
        distractions: 0,
        videosWatched: 0
      };
      
      document.getElementById('total-focus-time').textContent = userData.focusTime;
      document.getElementById('total-distractions').textContent = userData.distractions;
      document.getElementById('videos-watched').textContent = userData.videosWatched;
      document.getElementById('total-points').textContent = userData.points;
      
      points = userData.points;
    }
    
    // Save user data to localStorage
    function saveUserData() {
      localStorage.setItem('focusModeData', JSON.stringify(userData));
      
      // Update stats display
      document.getElementById('total-focus-time').textContent = userData.focusTime;
      document.getElementById('total-distractions').textContent = userData.distractions;
      document.getElementById('videos-watched').textContent = userData.videosWatched;
      document.getElementById('total-points').textContent = userData.points;
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Add more URL button
      document.getElementById('add-more-url').addEventListener('click', function() {
        const urlInputs = document.getElementById('url-inputs');
        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.className = 'url-input youtube-url';
        newInput.placeholder = 'Paste YouTube URL here';
        urlInputs.appendChild(newInput);
      });
      
      // Start Focus Mode button
      document.getElementById('start-focus-mode').addEventListener('click', startFocusMode);
      
      // Restart button
      document.getElementById('restart-button').addEventListener('click', endFocusMode);
      
      // Play/Pause button for lofi music
      document.getElementById('play-pause').addEventListener('click', toggleBackgroundMusic);
      
      // Timer button
      document.getElementById('start-timer').addEventListener('click', function() {
        const minutes = parseInt(document.getElementById('timer-minutes').value);
        if (minutes > 0) {
          alert(`Timer set for ${minutes} minutes`);
          // Timer implementation would go here
        }
      });
      
      // Tab visibility change
      document.addEventListener('visibilitychange', function() {
        if (document.hidden && focusModeActive) {
          playAlarmSound();
          deductPoints(10);
          
          // Update distraction count
          userData.distractions += 1;
          saveUserData();
        }
      });
      
      // Key press for video switching
      document.addEventListener('keydown', function(e) {
        if (e.key === 'T' && focusModeActive) {
          switchToNextVideo();
        }
      });
      
      // Prevent tab closing (will show a confirmation)
      window.addEventListener('beforeunload', function(e) {
        if (focusModeActive) {
          e.preventDefault();
          e.returnValue = 'Are you sure you want to leave? You will lose points!';
          return e.returnValue;
        }
      });
    }
    
    // Setup audio visualizer
    function setupAudioVisualizer() {
      const audioElement = document.getElementById('background-music');
      const canvas = document.getElementById('audio-visualizer');
      const canvasCtx = canvas.getContext('2d');
      
      canvas.width = 200;
      canvas.height = 80;
      
      // Audio context setup
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const analyser = audioCtx.createAnalyser();
      const source = audioCtx.createMediaElementSource(audioElement);
      
      source.connect(analyser);
      analyser.connect(audioCtx.destination);
      
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      
      // Visualization loop
      function draw() {
        requestAnimationFrame(draw);
        
        if (audioElement.paused) {
          canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
          return;
        }
        
        analyser.getByteFrequencyData(dataArray);
        
        canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
        
        const barWidth = (canvas.width / bufferLength) * 2.5;
        let barHeight;
        let x = 0;
        
        for(let i = 0; i < bufferLength; i++) {
          barHeight = dataArray[i] / 2;
          
          // Create gradient from blue to purple
          const gradient = canvasCtx.createLinearGradient(0, canvas.height - barHeight, 0, canvas.height);
          gradient.addColorStop(0, '#3a86ff');
          gradient.addColorStop(1, '#8338ec');
          
          canvasCtx.fillStyle = gradient;
          canvasCtx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
          
          x += barWidth + 1;
        }
      }
      
      draw();
    }
    
    // Toggle background music
    function toggleBackgroundMusic() {
      const audioElement = document.getElementById('background-music');
      const playPauseButton = document.getElementById('play-pause');
      
      if (audioElement.paused) {
        audioElement.play();
        playPauseButton.textContent = '❚❚';
      } else {
        audioElement.pause();
        playPauseButton.textContent = '▶️';
      }
    }
    
    // Play alarm sound
    function playAlarmSound() {
      const alarmSound = document.getElementById('alarm-sound');
      
      // Clear any existing alarm loops
      if (alarmLoopInterval) {
        clearInterval(alarmLoopInterval);
        alarmLoopInterval = null;
      }
      
      // Loop the alarm sound
      alarmSound.play();
      alarmLoopInterval = setInterval(() => {
        alarmSound.currentTime = 0;
        alarmSound.play();
      }, 2000); // Loop every 2 seconds
      
      // Stop alarm when tab gets focus again
      document.addEventListener('visibilitychange', function stopAlarm() {
        if (!document.hidden && alarmLoopInterval) {
          clearInterval(alarmLoopInterval);
          alarmLoopInterval = null;
          alarmSound.pause();
          alarmSound.currentTime = 0;
          document.removeEventListener('visibilitychange', stopAlarm);
        }
      });
    }
    
    // Deduct points
    function deductPoints(amount) {
      points -= amount;
      userData.points -= amount;
      document.getElementById('points-display').textContent = `Points: ${points}`;
      saveUserData();
    }
    
    // Add points
    function addPoints(amount) {
      points += amount;
      userData.points += amount;
      document.getElementById('points-display').textContent = `Points: ${points}`;
      saveUserData();
    }
    
    // Start Focus Mode
    function startFocusMode() {
      const urls = Array.from(document.querySelectorAll('.youtube-url'))
        .map(input => input.value)
        .filter(url => url.trim() !== '');
      
      if (urls.length === 0) {
        alert('Please enter at least one YouTube URL');
        return;
      }
      
      playlist = urls.map(url => {
        // Extract video ID from URL
        const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
        const match = url.match(regex);
        return match ? match[1] : url;
      });
      
      document.getElementById('home-screen').classList.add('hidden');
      document.getElementById('focus-mode-screen').classList.remove('hidden');
      
      // Initialize the YouTube player
      if (typeof YT !== 'undefined' && YT.loaded) {
        createYouTubePlayer();
      } else {
        // Wait for YouTube API to load
        window.onYouTubeIframeAPIReady = createYouTubePlayer;
      }
      
      focusModeActive = true;
      startPomodoroTimer();
      
      // Set initial points display
      document.getElementById('points-display').textContent = `Points: ${points}`;
      
      // Track this video as watched
      userData.videosWatched += 1;
      saveUserData();
    }
    
    // Create YouTube Player
    function createYouTubePlayer() {
      player = new YT.Player('youtube-player', {
        height: '100%',
        width: '100%',
        videoId: playlist[0],
        playerVars: {
          'autoplay': 1,
          'controls': 1,
          'rel': 0,
          'fs': 1
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }
    
    // When YouTube player is ready
    function onPlayerReady(event) {
      event.target.playVideo();
    }
    
    // When YouTube player state changes
    function onPlayerStateChange(event) {
      // When video ends, go to next video
      if (event.data === YT.PlayerState.ENDED) {
        switchToNextVideo();
      }
    }
    
    // Switch to next video
    function switchToNextVideo() {
      currentVideoIndex = (currentVideoIndex + 1) % playlist.length;
      player.loadVideoById(playlist[currentVideoIndex]);
      
      // Track this video as watched
      userData.videosWatched += 1;
      saveUserData();
    }
    
    // Start Pomodoro Timer
    function startPomodoroTimer() {
      pomodoroTimeLeft = 50 * 60; // 50 minutes in seconds
      updatePomodoroDisplay();
      
      pomodoroInterval = setInterval(() => {
        pomodoroTimeLeft--;
        updatePomodoroDisplay();
        
        if (pomodoroTimeLeft <= 0) {
          // Pomodoro completed
          clearInterval(pomodoroInterval);
          
          // Add points for completion
          addPoints(80);
          
          // Add to total focus time
          userData.focusTime += 50;
          saveUserData();
          
          alert('Congratulations! You completed a 50-minute focus session and earned 80 points!');
        }
      }, 1000);
    }
    
    // Update Pomodoro Timer Display
    function updatePomodoroDisplay() {
      const minutes = Math.floor(pomodoroTimeLeft / 60);
      const seconds = pomodoroTimeLeft % 60;
      
      document.getElementById('pomodoro-timer').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // End Focus Mode
    function endFocusMode() {
      document.getElementById('focus-mode-screen').classList.add('hidden');
      document.getElementById('home-screen').classList.remove('hidden');
      
      // Stop pomodoro timer
      if (pomodoroInterval) {
        clearInterval(pomodoroInterval);
      }
      
      // Stop any alarm sounds
      if (alarmLoopInterval) {
        clearInterval(alarmLoopInterval);
        alarmLoopInterval = null;
        
        const alarmSound = document.getElementById('alarm-sound');
        alarmSound.pause
